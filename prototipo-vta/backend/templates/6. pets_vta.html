<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Pets - Agenda VTA</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Bibliotecas para PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* Reset e configurações básicas */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Paleta de cores VTA */
        :root {
            --vta-green: #52B788;
            --vta-green-light: #74C69D;
            --vta-green-dark: #40916C;
            --vta-blue: #2E86AB;
            --vta-blue-light: #48A3C7;
            --vta-blue-dark: #1B5E7A;
            --vta-orange: #F77F00;
            --vta-orange-light: #FCBF49;
            --vta-orange-dark: #D62828;
            --white: #FFFFFF;
            --gray-light: #F8F9FA;
            --gray-medium: #6C757D;
            --gray-dark: #343A40;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gray-light);
            color: var(--gray-dark);
            overflow-x: hidden;
        }

        /* Layout Principal */
        .dashboard-container {
            display: grid;
            grid-template-rows: auto 1fr;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--vta-green) 0%, var(--vta-green-dark) 100%);
            color: var(--white);
            padding: 1rem 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-mini {
            width: 45px;
            height: 45px;
            background: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--vta-green);
            font-size: 1.5rem;
        }

        .header-title h1 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .header-subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            background: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--vta-green);
            font-weight: bold;
        }

        .user-details h3 {
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .user-role {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(15deg);
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 220px 1fr;
            gap: 2rem;
            padding: 1.5rem 2rem;
            max-width: 100%;
        }

        /* Sidebar */
        .sidebar {
            background: var(--white);
            border-radius: 15px;
            padding: 1rem 1.25rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            width: 220px;
            height: fit-content;
            position: relative; /* REMOVE fixed */
        }

        @media (max-width: 1450px) {
            .sidebar {
                left: 2rem;
            }
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .sidebar {
                width: 100%;
            }
        }

        .sidebar-section {
            margin-bottom: 1.5rem;
        }

        .sidebar-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray-medium);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.75rem;
            padding-left: 0.25rem;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 0.5rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.65rem;
            padding: 0.65rem 0.85rem;
            text-decoration: none;
            color: var(--gray-dark);
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .nav-link:hover,
        .nav-link.active {
            background: linear-gradient(135deg, var(--vta-green) 0%, var(--vta-green-light) 100%);
            color: var(--white);
            transform: translateX(5px);
        }

        .nav-link i {
            font-size: 1rem;
            width: 18px;
        }

        /* Pets Content */
        .pets-content {
            display: grid;
            gap: 1.5rem;
            width: 100%;
        }

        /* Page Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--white);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            gap: 1rem;
            flex-wrap: wrap;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--gray-dark);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex: 1;
        }

        .page-title i {
            color: var(--vta-orange);
            font-size: 1.8rem;
        }

        .page-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--vta-green) 0%, var(--vta-green-light) 100%);
            color: var(--white);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(82, 183, 136, 0.3);
        }

        .btn-secondary {
            background: var(--gray-light);
            color: var(--gray-dark);
            border: 1px solid var(--gray-medium);
        }

        .btn-secondary:hover {
            background: var(--gray-medium);
            color: var(--white);
        }

        /* Form and Table Container */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        /* Form Section - Agora dentro do Modal, estilos ajustados */
        .form-section {
            /* background: var(--white); removido pois o modal já tem fundo */
            /* padding: 2rem; removido */
            /* border-radius: 15px; removido */
            /* box-shadow: ... removido */
            height: fit-content;
        }

        .form-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--gray-dark);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--gray-dark);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--gray-light);
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--vta-green);
            box-shadow: 0 0 0 3px rgba(82, 183, 136, 0.1);
        }

        .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            appearance: none;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: flex-end;
        }

        /* Table Section */
        .table-section {
            background: var(--white);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .table-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-dark);
        }

        .search-box {
            position: relative;
            width: 300px;
        }

        .table-container {
            overflow-x: auto;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 2px solid var(--gray-light);
            border-radius: 25px;
            font-size: 0.9rem;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--vta-green);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-medium);
        }

        .pets-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .pets-table th,
        .pets-table td {
            padding: 1rem 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
        }

        .pets-table th {
            background: var(--gray-light);
            font-weight: 600;
            color: var(--gray-dark);
            position: sticky;
            top: 0;
        }

        .pets-table tbody tr:hover {
            background: rgba(82, 183, 136, 0.05);
        }

        .pet-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--vta-orange) 0%, var(--vta-orange-light) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: bold;
            margin-right: 0.75rem;
        }

        .pet-info {
            display: flex;
            align-items: center;
        }

        .pet-details h4 {
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        .pet-details p {
            font-size: 0.8rem;
            color: var(--gray-medium);
        }

        .species-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .species-dog { background: rgba(82, 183, 136, 0.1); color: var(--vta-green); }
        .species-cat { background: rgba(46, 134, 171, 0.1); color: var(--vta-blue); }
        .species-bird { background: rgba(247, 127, 0, 0.1); color: var(--vta-orange); }
        .species-other { background: rgba(108, 117, 125, 0.1); color: var(--gray-medium); }

        .actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-sm {
            padding: 0.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .btn-edit {
            background: var(--vta-blue);
            color: var(--white);
        }

        .btn-edit:hover {
            background: var(--vta-blue-dark);
        }

        .btn-delete {
            background: var(--vta-orange-dark);
            color: var(--white);
        }

        .btn-delete:hover {
            background: #B91C1C;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--vta-orange), var(--vta-orange-light));
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--vta-orange), var(--vta-orange-light));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
            margin: 0 auto 1rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-dark);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--gray-medium);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .modal.show {
            display: flex;
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: var(--white);
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        /* Modal Grande para Formulário */
        .modal-lg {
            max-width: 800px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .sidebar {
                position: static;
                order: 2;
            }

            .page-header {
                flex-direction: column;
                align-items: stretch;
            }

            .page-actions {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            body {
                background: linear-gradient(180deg, var(--vta-green) 0%, var(--gray-light) 45%);
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .header-right {
                width: 100%;
                justify-content: space-between;
            }

            .header {
                padding: 0.9rem 1.25rem;
            }

            .main-content {
                grid-template-columns: 1fr;
                padding: 1rem 1.1rem 1.3rem;
                gap: 1.1rem;
                max-width: 520px;
                margin: 0 auto;
            }

            .sidebar {
                width: 100%;
                max-width: 520px;
                margin: 0.5rem auto 0;
                padding: 0.9rem 0.9rem;
                background: var(--white);
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
                border-radius: 15px;
                position: static;
            }

            .sidebar-title {
                text-align: center;
                margin-bottom: 0.5rem;
            }

            .nav-menu {
                list-style: none;
                padding: 0;
                margin: 0;
            }

            .nav-item {
                margin-bottom: 0.45rem;
            }

            .nav-link {
                padding: 0.55rem 0.8rem;
                border-radius: 10px;
                background: transparent;
                border: none;
                box-shadow: none;
            }

            .pets-content {
                max-width: 520px;
                margin: 0 auto;
                gap: 1.1rem;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.9rem;
                padding: 1.35rem 1.1rem;
            }

            .page-title {
                font-size: 1.6rem;
            }

            .page-actions {
                width: 100%;
                justify-content: center;
                gap: 0.6rem;
            }

            .page-actions .btn {
                width: 100%;
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .stat-card {
                padding: 1.25rem 1.1rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .search-box {
                width: 100%;
            }

            .pets-table {
                font-size: 0.9rem;
            }

            .user-details {
                display: none;
            }

            .table-section {
                border-radius: 18px;
                padding: 1.4rem 1.1rem;
            }

            .table-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.6rem;
            }

            .search-box {
                width: 100%;
            }

            .table-container {
                overflow: visible;
            }

            .pets-table thead {
                display: none;
            }

            .pets-table tbody {
                display: grid;
                gap: 0.85rem;
            }

            .pets-table tr {
                display: block;
                background: var(--white);
                border: 1px solid rgba(0, 0, 0, 0.06);
                border-radius: 14px;
                box-shadow: 0 6px 18px rgba(0, 0, 0, 0.05);
                padding: 0.75rem 0.9rem;
            }

            .pets-table td {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                gap: 0.75rem;
                padding: 0.55rem 0;
                border: none;
                border-bottom: 1px solid rgba(0, 0, 0, 0.04);
            }

            .pets-table td:last-child {
                border-bottom: none;
            }

            .pets-table td::before {
                content: attr(data-label);
                font-weight: 600;
                color: var(--gray-medium);
                font-size: 0.9rem;
                min-width: 120px;
            }

            .pets-table td > * {
                text-align: right;
                width: 100%;
            }

            /* Labels por coluna */
            .pets-table td:nth-child(1)::before { content: 'Pet'; }
            .pets-table td:nth-child(2)::before { content: 'Espécie'; }
            .pets-table td:nth-child(3)::before { content: 'Tutor'; }
            .pets-table td:nth-child(4)::before { content: 'Idade'; }
            .pets-table td:nth-child(5)::before { content: 'Status'; }
            .pets-table td:nth-child(6)::before { content: 'Ações'; }

            .pet-info {
                align-items: center;
                gap: 0.75rem;
            }

            .actions {
                justify-content: flex-end;
            }

            .btn {
                padding: 0.6rem 1.1rem;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 576px) {
            .header-title h1 {
                font-size: 1.4rem;
            }

            .page-title {
                font-size: 1.45rem;
            }

            .stat-card {
                padding: 1.1rem 1rem;
            }

            .pets-table td::before {
                min-width: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo-mini">
                        <i class="fas fa-stethoscope"></i>
                    </div>
                    <div class="header-title">
                        <h1>Agenda VTA</h1>
                        <p class="header-subtitle">Sistema de Agendamento Veterinário</p>
                    </div>
                </div>
                
                <div class="header-right">
                    <div class="user-info">
                        <div class="user-avatar">A</div>
                        <div class="user-details">
                            <h3>Administrador</h3>
                            <p class="user-role">admin@vta.com</p>
                        </div>
                    </div>
                    <button class="logout-btn" onclick="logout()" title="Sair do sistema">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </header>

        <main class="main-content">
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3 class="sidebar-title">Menu Principal</h3>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="{{ url_for('dashboard') }}" class="nav-link">
                                <i class="fas fa-chart-pie"></i>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{ url_for('agenda_page') }}" class="nav-link">
                                <i class="fas fa-calendar"></i>
                                Agenda
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{ url_for('agendamento_page') }}" class="nav-link">
                                <i class="fas fa-plus-circle"></i>
                                Novo Agendamento
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{ url_for('clientes_page') }}" class="nav-link">
                                <i class="fas fa-users"></i>
                                Clientes
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{ url_for('pets_page') }}" class="nav-link active">
                                <i class="fas fa-paw"></i>
                                Pets
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{ url_for('salas_page') }}" class="nav-link">
                                <i class="fas fa-door-open"></i>
                                Salas
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">Administração</h3>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="{{ url_for('relatorios_dashboard') }}" class="nav-link">
                                <i class="fas fa-chart-bar"></i>
                                Relatórios ADM
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{ url_for('relatorios_pets') }}" class="nav-link">
                                <i class="fas fa-file-medical"></i>
                                Histórico Pets
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{ url_for('usuarios_page') }}" class="nav-link">
                                <i class="fas fa-user-cog"></i>
                                Usuários
                            </a>
                        </li>
                    </ul>
                </div>
            </aside>

            <div class="pets-content">
                <section class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-paw"></i>
                        Cadastro de Pets
                    </h1>
                    <div class="page-actions">
                        <button class="btn btn-secondary" onclick="exportarPets()">
                            <i class="fas fa-download"></i>
                            Exportar
                        </button>
                        <button class="btn btn-primary" onclick="novoPet()">
                            <i class="fas fa-plus"></i>
                            Novo Pet
                        </button>
                    </div>
                </section>

                <section class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-paw"></i>
                        </div>
                        <div class="stat-value">0</div>
                        <div class="stat-label">Total de Pets</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-dog"></i>
                        </div>
                        <div class="stat-value">0</div>
                        <div class="stat-label">Cães</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-cat"></i>
                        </div>
                        <div class="stat-value">0</div>
                        <div class="stat-label">Gatos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-dove"></i>
                        </div>
                        <div class="stat-value">0</div>
                        <div class="stat-label">Outros</div>
                    </div>
                </section>

                <section class="content-grid" id="contentGrid">
                    <div class="table-section">
                        <div class="table-header">
                            <h2 class="table-title">Pets Cadastrados</h2>
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" placeholder="Buscar pets..." 
                                       onkeyup="filtrarPets(this.value)">
                            </div>
                        </div>

                        <div class="table-container">
                            <table class="pets-table" id="tabelaPets">
                                <thead>
                                    <tr>
                                        <th>Pet</th>
                                        <th>Espécie</th>
                                        <th>Tutor</th>
                                        <th>Idade</th>
                                        <th>Status</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dados carregados via backend -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

    <!-- Modal de Cadastro/Edição de Pet -->
    <div class="modal" id="modalFormPet">
        <div class="modal-content modal-lg">
            <div class="form-section">
                <h2 class="form-title">
                    <i class="fas fa-paw"></i>
                    <span id="modalTitle">Cadastrar Pet</span>
                </h2>
                
                <form id="petForm" onsubmit="salvarPet(event)">
                    <div class="form-group">
                        <label class="form-label" for="nomePet">Nome do Pet *</label>
                        <input type="text" class="form-control" id="nomePet" name="nomePet" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="especie">Espécie *</label>
                            <select class="form-control form-select" id="especie" name="especie" required onchange="atualizarRacas()">
                                <option value="">Selecione...</option>
                                <option value="cao">Cão</option>
                                <option value="gato">Gato</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="raca">Raça</label>
                            <input type="text" class="form-control" id="raca" name="raca" list="listaRacas" placeholder="Digite ou selecione a raça">
                            <datalist id="listaRacas"></datalist>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="sexo">Sexo *</label>
                            <select class="form-control form-select" id="sexo" name="sexo" required>
                                <option value="">Selecione...</option>
                                <option value="macho">Macho</option>
                                <option value="femea">Fêmea</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="dataNascimento">Data de Nascimento</label>
                            <input type="date" class="form-control" id="dataNascimento" name="dataNascimento">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="peso">Peso (kg)</label>
                            <input type="number" class="form-control" id="peso" name="peso" step="0.1" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="cor">Cor/Pelagem</label>
                            <input type="text" class="form-control" id="cor" name="cor" placeholder="Ex: Marrom, Preto e branco">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="tutor">Tutor *</label>
                        <select class="form-control form-select" id="tutor" name="tutor" required>
                            <option value="">Carregando clientes...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="observacoes">Observações</label>
                        <textarea class="form-control form-textarea" id="observacoes" name="observacoes" 
                                 placeholder="Informações adicionais, alergias, medicamentos, comportamento..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="limparFormulario()">
                            <i class="fas fa-times"></i>
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary" id="btnSalvar">
                            <i class="fas fa-save"></i>
                            Salvar Pet
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal" id="modalConfirmacao">
        <div class="modal-content">
            <h3 style="margin-bottom: 1rem; color: var(--vta-orange-dark);">
                <i class="fas fa-exclamation-triangle"></i>
                Confirmar Exclusão
            </h3>
            <p style="margin-bottom: 2rem;">
                Tem certeza que deseja excluir este pet? Esta ação não pode ser desfeita.
            </p>
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="fecharModal()">Cancelar</button>
                <button class="btn btn-delete" onclick="excluirPet()">
                    <i class="fas fa-trash"></i>
                    Excluir
                </button>
            </div>
        </div>
    </div>

    <script>
        // Variável global para controle de edição
        let petEditando = null;
        let petParaExcluir = null;
        let petsList = [];

        // Dados das raças por espécie
        const racasPorEspecie = {
            cao: [
                'Akita', 'Beagle', 'Border Collie', 'Bulldog Francês', 'Bulldog Inglês',
                'Chihuahua', 'Cocker Spaniel', 'Dachshund', 'Doberman', 'Fila Brasileiro',
                'Golden Retriever', 'Husky Siberiano', 'Labrador', 'Lhasa Apso', 'Maltês',
                'Pastor Alemão', 'Pinscher', 'Poodle', 'Pug', 'Rottweiler', 'Shih Tzu',
                'Yorkshire', 'SRD (Sem Raça Definida)'
            ],
            gato: [
                'Abissínio', 'Angorá', 'Bengali', 'Birmanês', 'Bobtail Japonês',
                'British Shorthair', 'Chartreux', 'Himalaio', 'Maine Coon', 'Manx',
                'Munchkin', 'Persa', 'Ragdoll', 'Russian Blue', 'Sagrado da Birmânia',
                'Siamês', 'Sphynx', 'SRD (Sem Raça Definida)'
            ],
            ave: [
                'Agapornis', 'Bem-te-vi', 'Calopsita', 'Canário', 'Curió', 'Papagaio',
                'Periquito', 'Sabiá', 'Trinca-ferro', 'Outros'
            ],
            roedor: [
                'Chinchila', 'Coelho', 'Furão', 'Hamster', 'Porquinho-da-índia', 'Rato', 'Outros'
            ],
            reptil: [
                'Cobra', 'Iguana', 'Jabuti', 'Lagarto', 'Tartaruga', 'Outros'
            ],
            outros: ['Outros']
        };

        // Carregar dados ao iniciar
        document.addEventListener('DOMContentLoaded', () => {
            carregarClientes();
            carregarPets();
            
            // Animações
            const animatedElements = document.querySelectorAll('.stat-card, .form-section, .table-section');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            });
            
            animatedElements.forEach(el => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(20px)';
                el.style.transition = 'all 0.6s ease';
                observer.observe(el);
            });
        });

        async function carregarClientes() {
            try {
                const response = await fetch('/api/clientes/all');
                const clientes = await response.json();
                const select = document.getElementById('tutor');
                select.innerHTML = '<option value="">Selecione o cliente...</option>';
                clientes.forEach(cliente => {
                    const option = document.createElement('option');
                    option.value = cliente.id;
                    option.textContent = cliente.nome;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Erro ao carregar clientes:', error);
            }
        }

        async function carregarPets() {
            try {
                const response = await fetch('/api/pets');
                petsList = await response.json();
                renderizarTabela(petsList);
                atualizarEstatisticas(petsList);
            } catch (error) {
                console.error('Erro ao carregar pets:', error);
            }
        }

        function renderizarTabela(pets) {
            const tbody = document.querySelector('#tabelaPets tbody');
            tbody.innerHTML = '';
            
            pets.forEach(pet => {
                const tr = document.createElement('tr');
                
                let speciesClass = 'species-other';
                let speciesLabel = 'Outros';
                
                if (pet.especie === 'cao') { speciesClass = 'species-dog'; speciesLabel = 'Cão'; }
                else if (pet.especie === 'gato') { speciesClass = 'species-cat'; speciesLabel = 'Gato'; }
                else if (pet.especie === 'ave') { speciesClass = 'species-bird'; speciesLabel = 'Ave'; }
                
                tr.innerHTML = `
                    <td>
                        <div class="pet-info">
                            <div class="pet-avatar">${pet.nome.charAt(0).toUpperCase()}</div>
                            <div class="pet-details">
                                <h4>${pet.nome}</h4>
                                <p>${pet.raca || 'Raça não informada'} • ${pet.sexo}</p>
                            </div>
                        </div>
                    </td>
                    <td><span class="species-tag ${speciesClass}">${speciesLabel}</span></td>
                    <td>${pet.tutor_nome}</td>
                    <td>${pet.idade}</td>
                    <td><span class="species-tag species-dog">Ativo</span></td>
                    <td>
                        <div class="actions">
                            <button class="btn-sm btn-edit" onclick="editarPet(${pet.id})" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-sm btn-delete" onclick="confirmarExclusao(${pet.id})" title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function atualizarEstatisticas(pets) {
            const total = pets.length;
            const caes = pets.filter(p => p.especie === 'cao').length;
            const gatos = pets.filter(p => p.especie === 'gato').length;
            const outros = total - caes - gatos;
            
            document.querySelectorAll('.stat-value')[0].textContent = total;
            document.querySelectorAll('.stat-value')[1].textContent = caes;
            document.querySelectorAll('.stat-value')[2].textContent = gatos;
            document.querySelectorAll('.stat-value')[3].textContent = outros;
        }

        // Função para atualizar raças baseado na espécie
        function atualizarRacas() {
            const especieSelect = document.getElementById('especie');
            const racaInput = document.getElementById('raca');
            const listaRacas = document.getElementById('listaRacas');
            const especieSelecionada = especieSelect.value;

            // Limpar input e lista
            racaInput.value = '';
            listaRacas.innerHTML = '';

            if (especieSelecionada && racasPorEspecie[especieSelecionada]) {
                racasPorEspecie[especieSelecionada].forEach(raca => {
                    const option = document.createElement('option');
                    option.value = raca;
                    listaRacas.appendChild(option);
                });
            }
        }

        // Função para salvar pet
        async function salvarPet(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);

            // Validações de bom senso (Idade e Peso)
            const dataNascimento = formData.get('dataNascimento');
            const peso = formData.get('peso');

            if (dataNascimento) {
                const dataNasc = new Date(dataNascimento);
                const hoje = new Date();
                
                if (dataNasc > hoje) {
                    alert('A data de nascimento não pode ser no futuro.');
                    return;
                }

                // Cálculo aproximado da idade em anos
                const diffAnos = hoje.getFullYear() - dataNasc.getFullYear();
                
                // Limite de 100 anos (cobre tartarugas e aves longevas, mas bloqueia erros grosseiros como 2000 anos)
                if (diffAnos > 100) {
                    alert(`A data informada resulta em uma idade de ${diffAnos} anos. Por favor verifique o ano de nascimento.`);
                    return;
                }
            }

            if (peso) {
                const pesoVal = parseFloat(peso);
                // Limite de 300kg (cobre qualquer pet doméstico razoável)
                if (pesoVal > 300) {
                    alert(`O peso informado (${pesoVal}kg) parece incorreto. Por favor verifique.`);
                    return;
                }
                if (pesoVal < 0) {
                    alert('O peso não pode ser negativo.');
                    return;
                }
            }

            const petData = {
                nome: formData.get('nomePet'),
                especie: formData.get('especie'),
                raca: formData.get('raca'),
                sexo: formData.get('sexo'),
                dataNascimento: formData.get('dataNascimento'),
                peso: formData.get('peso'),
                cor: formData.get('cor'),
                tutor: formData.get('tutor'),
                observacoes: formData.get('observacoes')
            };

            try {
                let url = '/api/pets';
                let method = 'POST';
                
                if (petEditando) {
                    url = `/api/pets/${petEditando}`;
                    method = 'PUT';
                }
                
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(petData)
                });
                
                if (response.ok) {
                    alert(petEditando ? 'Pet atualizado com sucesso!' : 'Pet cadastrado com sucesso!');
                    limparFormulario();
                    carregarPets();
                } else {
                    alert('Erro ao salvar pet.');
                }
            } catch (error) {
                console.error('Erro:', error);
                alert('Erro ao salvar pet.');
            }
        }

        // Função para limpar formulário
        function limparFormulario() {
            document.getElementById('petForm').reset();
            document.getElementById('listaRacas').innerHTML = '';
            petEditando = null;
            document.getElementById('btnSalvar').innerHTML = '<i class="fas fa-save"></i> Salvar Pet';
            document.getElementById('modalTitle').textContent = 'Cadastrar Pet';
            
            // Fechar Modal
            document.getElementById('modalFormPet').classList.remove('show');
        }

        // Função para editar pet
        function editarPet(id) {
            const pet = petsList.find(p => p.id === id);
            if (pet) {
                petEditando = id;
                document.getElementById('modalTitle').textContent = 'Editar Pet';
                document.getElementById('nomePet').value = pet.nome;
                document.getElementById('especie').value = pet.especie;
                atualizarRacas();
                document.getElementById('raca').value = pet.raca;
                document.getElementById('sexo').value = pet.sexo;
                document.getElementById('dataNascimento').value = pet.data_nascimento;
                document.getElementById('peso').value = pet.peso;
                document.getElementById('cor').value = pet.cor;
                document.getElementById('tutor').value = pet.tutor_id;
                document.getElementById('observacoes').value = pet.observacoes;
                
                document.getElementById('btnSalvar').innerHTML = '<i class="fas fa-save"></i> Atualizar Pet';
                
                // Abrir Modal
                document.getElementById('modalFormPet').classList.add('show');
            }
        }

        // Função para confirmar exclusão
        function confirmarExclusao(id) {
            petParaExcluir = id;
            document.getElementById('modalConfirmacao').classList.add('show');
        }

        // Função para excluir pet
        async function excluirPet() {
            if (petParaExcluir) {
                try {
                    const response = await fetch(`/api/pets/${petParaExcluir}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        alert('Pet excluído com sucesso!');
                        carregarPets();
                    } else {
                        alert('Erro ao excluir pet.');
                    }
                } catch (error) {
                    console.error('Erro:', error);
                    alert('Erro ao excluir pet.');
                }
                fecharModal();
            }
        }

        // Função para fechar modal
        function fecharModal() {
            document.getElementById('modalConfirmacao').classList.remove('show');
            petParaExcluir = null;
        }

        // Função para filtrar pets
        function filtrarPets(termo) {
            const termoLower = termo.toLowerCase();
            const petsFiltrados = petsList.filter(pet => 
                pet.nome.toLowerCase().includes(termoLower) || 
                pet.tutor_nome.toLowerCase().includes(termoLower)
            );
            renderizarTabela(petsFiltrados);
        }

        // Função para novo pet
        function novoPet() {
            document.getElementById('petForm').reset();
            document.getElementById('listaRacas').innerHTML = '';
            petEditando = null;
            document.getElementById('btnSalvar').innerHTML = '<i class="fas fa-save"></i> Salvar Pet';
            document.getElementById('modalTitle').textContent = 'Cadastrar Pet';
            
            // Abrir Modal
            document.getElementById('modalFormPet').classList.add('show');
        }

        // Função para exportar pets (PDF)
        async function exportarPets() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Carregar logo
            const logoUrl = '/static/img/logo.png';
            let logoData = null;
            try {
                logoData = await new Promise((resolve) => {
                    const img = new Image();
                    img.src = logoUrl;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        resolve(canvas.toDataURL('image/png'));
                    };
                    img.onerror = () => resolve(null);
                });
            } catch (e) {
                console.error("Erro ao carregar logo", e);
            }

            // Configurações do PDF
            const pageWidth = doc.internal.pageSize.getWidth();
            const margin = 14;

            // Adicionar Logo se existir
            if (logoData) {
                doc.addImage(logoData, 'PNG', 30, 10, 20, 20);
            }

            // Título (sem fundo colorido)
            doc.setTextColor(0, 0, 0); // Preto
            doc.setFontSize(20);
            doc.setFont("helvetica", "bold");
            // Ajustar posição X baseado na presença do logo
            doc.text('Relatório de Pets - Agenda VTA', logoData ? 60 : margin, 25);
            
            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            doc.text(`Gerado em: ${new Date().toLocaleDateString()} às ${new Date().toLocaleTimeString()}`, logoData ? 60 : margin, 32);

            // Dados da tabela
            const tableColumn = ["Pet", "Espécie", "Raça", "Sexo", "Tutor", "Idade"];
            const tableRows = [];

            petsList.forEach(pet => {
                const petData = [
                    pet.nome,
                    pet.especie.charAt(0).toUpperCase() + pet.especie.slice(1),
                    pet.raca || '-',
                    pet.sexo.charAt(0).toUpperCase() + pet.sexo.slice(1),
                    pet.tutor_nome,
                    pet.idade
                ];
                tableRows.push(petData);
            });

            doc.autoTable({
                head: [tableColumn],
                body: tableRows,
                startY: 50,
                theme: 'plain',
                styles: { fontSize: 10, cellPadding: 3 },
                headStyles: { 
                    fillColor: false, 
                    textColor: 0, 
                    fontStyle: 'bold',
                    lineWidth: {bottom: 0.5},
                    lineColor: 200
                },
                columnStyles: {
                    0: { fontStyle: 'bold' }
                }
            });

            doc.save('pets_vta.pdf');
        }

        // Função para logout
        function logout() {
            if (confirm('Tem certeza que deseja sair do sistema?')) {
                window.location.href = '/logout';
            }
        }

        // Fechar modal clicando fora dele
        window.onclick = function(event) {
            const modalConfirm = document.getElementById('modalConfirmacao');
            const modalForm = document.getElementById('modalFormPet');
            
            if (event.target === modalConfirm) {
                fecharModal();
            }
            if (event.target === modalForm) {
                limparFormulario();
            }
        }

        // Animação de entrada para os cards
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        });

        // Observar elementos para animação
        document.addEventListener('DOMContentLoaded', () => {
            const animatedElements = document.querySelectorAll('.stat-card, .form-section, .table-section');
            animatedElements.forEach(el => {
                el.style.opacity = '0';
                el.style.transform = 'translateY(20px)';
                el.style.transition = 'all 0.6s ease';
                observer.observe(el);
            });
        });
    </script>
   <script src="{{ url_for('static', filename='assets/js/vta-nav.js') }}" defer></script>
</body>
</html>